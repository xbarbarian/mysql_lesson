USE vk;
-- отключить safe mode   что бы заработал Update

CREATE TABLE `countries` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Идентификатор строки',
  `name` varchar(100) COLLATE utf8_unicode_ci NOT NULL COMMENT 'Название государства',
  `created_at` datetime DEFAULT current_timestamp() COMMENT 'Время создания строки',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT 'Время обновления строки',
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
);
CREATE TABLE `countries` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Идентификатор строки',
  `name` varchar(100) COLLATE utf8_unicode_ci NOT NULL COMMENT 'Название государства',
  `created_at` datetime DEFAULT current_timestamp() COMMENT 'Время создания строки',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT 'Время обновления строки',
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
);
CREATE TABLE `gender_type` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'Идентификатор строки',
  `name` varchar(100) COLLATE utf8_unicode_ci NOT NULL COMMENT 'название пола',
  `created_at` datetime DEFAULT current_timestamp() COMMENT 'Время создания строки',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT 'Время обновления строки',
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
);
SET SQL_SAFE_UPDATES = 0;

SELECT * FROM City;

UPDATE City c1
JOIN City c2
ON c1.created_at = c1.created_at AND c2.created_at = c2.created_at
SET c1.updated_at = (date_sub(c2.created_at, interval -20 year))
WHERE c1.updated_at < c1.created_at;

SELECT * FROM Country;

UPDATE Country c1
JOIN Country c2
ON c1.created_at = c1.created_at AND c2.created_at = c2.created_at
SET c1.updated_at = (date_sub(c2.created_at, interval -20 year))
WHERE c1.updated_at < c1.created_at;



ALTER TABLE media RENAME COLUMN filename TO filepath;
SELECT * FROM media;

UPDATE media m1
JOIN media m2
ON m1.created_at = m1.created_at AND m2.created_at = m2.created_at
SET m1.updated_at = (date_sub(m2.created_at, interval -90 day))
WHERE m1.updated_at < m1.created_at;